/*! audio-chunks 0.0.1 - slice/append/insert/subset/copy operations on AudioBuffer linked-list chunks */
!function(a){"object"==typeof exports?module.exports=a():window.AudioChunks=a()}(function(){return function(a){var b={};return b.context=a,b.DEFAULT_SAMPLES_SIZE=44100,b.createFromAudioBuffer=function(a,c){if(!a||0===a.length)throw"AudioBuffer is empty.";c||(c=b.DEFAULT_SAMPLES_SIZE);for(var d=new b.ChunkNode(new b.Chunk(a),null),e=d;e.chunk.length>c;e=e.split(c)[1]);return d},b.Chunk=function(a){this.audioBuffer=a,this.length=a.length},b.Chunk.prototype={getAudioBuffer:function(){return this.audioBuffer},forEachChannel:function(a,b){for(var c=this.audioBuffer.numberOfChannels,d=0;c>d;++d)a.call(b||a,this.audioBuffer.getChannelData(d),d)},clone:function(){var c=a.createBuffer(this.audioBuffer.numberOfChannels,this.length,a.sampleRate),d=new b.Chunk(c);return d.forEachChannel(function(a,b){a.set(this.audioBuffer.getChannelData(b))},this),d},split:function(c){var d=this.audioBuffer.numberOfChannels,e=a.createBuffer(d,c,a.sampleRate),f=a.createBuffer(d,this.length-c,a.sampleRate);return this.forEachChannel(function(a,b){e.getChannelData(b).set(a.subarray(0,c)),f.getChannelData(b).set(a.subarray(c,a.length))}),[new b.Chunk(e),new b.Chunk(f)]}},b.ChunkNode=function(a,b){this.chunk=a,this.next=b||null},b.ChunkNode.prototype={copy:function(){return new b.ChunkNode(this.chunk.clone(),this.next?this.next.copy():null)},clone:function(){return new b.ChunkNode(this.chunk,this.next)},set:function(a){this.chunk=a.chunk,this.next=a.next},forEach:function(a,b){for(var c=this;c;c=c.next)a.call(b||a,c)},map:function(a,b){for(var c=[],d=this;d;d=d.next)c.push(a.call(b||a,d));return c},length:function(){var a=0;return this.forEach(function(b){a+=b.chunk.length}),a},last:function(){for(var a=this;a.next;)a=a.next;return a},merge:function(){var c=a.createBuffer(this.chunk.audioBuffer.numberOfChannels,this.length(),a.sampleRate),d=new b.Chunk(c);return d.forEachChannel(function(a,b){var c=0;this.forEach(function(d){a.set(d.chunk.audioBuffer.getChannelData(b),c),c+=d.chunk.length})},this),this.chunk=d,this.next=null,this},append:function(a){return this.last().next=a,this},split:function(a,c){if(0===a)return[c||null,this];if(a<this.chunk.length){var d=this.chunk.split(a),e=new b.ChunkNode(d[1],this.next);return this.chunk=d[0],this.next=e,[this,e]}if(this.chunk.length<=a&&this.next)return this.next.split(a-this.chunk.length,this);throw new Error("index out of bound ("+a+")")},slice:function(a,b){if("number"!=typeof a)throw new Error("from is required");b||(b=this.length());var c=this.split(a),d=this.split(b),e=c[1].clone();return d[0].next=null,c[1].next=d[1],e},subset:function(a,b){if("number"!=typeof a)throw new Error("from is required");b||(b=this.length());for(var c=this.split(a)[1],d=this.split(b)[1],e=c.clone(),f=e,g=c;g.next&&g.next!==d;g=g.next)f.next=g.next.clone(),f=f.next;return f.next=null,e},insert:function(a,b){var c=this.split(b),d=c[0],e=c[1],f=a.last();return d?(d.next=a,f.next=e):(f.next=this.clone(),this.set(a)),this}},b}});